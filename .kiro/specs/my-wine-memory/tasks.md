# MyWineMemory 実装タスク

## プロジェクト初期設定

- [x] 1. プロジェクト基盤構築


  - React 18 + TypeScript + Vite プロジェクトの初期化
  - 必要な依存関係のインストール（Firebase SDK、Chart.js、React Router等）
  - 基本的なフォルダ構造の作成（src/components, src/pages, src/services等）
  - _要件: 全体的な技術基盤_

- [x] 1.1 開発環境設定

  - ESLint、Prettier、TypeScript設定ファイルの作成
  - Vite設定ファイル（vite.config.ts）の作成とPWA設定
  - 環境変数検証スクリプト（scripts/validate-env.js）の実装
  - _要件: 13.パフォーマンス最適化、21.運用・監視_


- [x] 1.2 Firebase プロジェクト設定

  - Firebase プロジェクトの作成と設定
  - Firestore、Authentication、Storage、Hostingの有効化
  - firebase.json設定ファイルの作成
  - _要件: 1.ユーザー認証システム_

## 認証システム実装

- [ ] 2. Firebase認証基盤の実装
  - Firebase設定ファイル（src/services/firebase.ts）の作成
  - FirebaseServiceクラスのシングルトンパターン実装
  - 基本的な認証メソッド（Google OAuth）の実装
  - _要件: 1.ユーザー認証システム_

- [ ] 2.1 AuthContextの実装
  - AuthContextとAuthProviderの作成
  - 認証状態管理（currentUser, userProfile, loading）
  - ゲストモード対応（localStorage利用）
  - _要件: 1.ユーザー認証システム_

- [ ] 2.2 ユーザープロフィール管理
  - Userデータモデルの型定義
  - ユーザー作成・更新・取得機能の実装
  - Firebase User → Firestore User の自動同期
  - _要件: 1.ユーザー認証システム_

- [ ] 2.3 ゲストデータ移行機能
  - ゲストデータの検出と要約機能
  - ゲスト → 認証ユーザーへのデータ移行処理
  - 移行完了後のローカルデータクリーンアップ
  - _要件: 1.ユーザー認証システム_

## エラーハンドリング・共通機能

- [ ] 3. エラーハンドリングシステム
  - AppError型定義とErrorContextの実装
  - Firebase エラー分類とユーザーフレンドリーメッセージ変換
  - 指数バックオフによる自動リトライ機能
  - _要件: 11.エラーハンドリング・オフライン対応_

- [ ] 3.1 共通UIコンポーネント
  - LoadingSpinnerコンポーネントの作成
  - ErrorMessageコンポーネントの作成（role="alert"対応）
  - 基本的なButtonコンポーネントの作成
  - _要件: 20.レスポンシブデザイン・アクセシビリティ_

- [ ] 3.2 ルーティング設定
  - React Router v7の設定
  - 全ページコンポーネントのReact.lazy遅延読み込み
  - ScrollToTopコンポーネントの実装
  - _要件: 20.レスポンシブデザイン・アクセシビリティ_

## データモデル・サービス層

- [ ] 4. データモデル定義
  - TastingRecord型の完全な定義
  - DetailedAnalysis、Environment、Citation型の定義
  - QuizProgress、UserQuizStats型の定義
  - _要件: 2.ワインテイスティング記録システム、4.ワインクイズ学習システム_

- [ ] 4.1 TastingRecordService実装
  - 基本CRUD操作（create, get, update, delete）の実装
  - ユーザー記録取得とフィルタリング機能
  - 人気ワイン取得機能（上位10件）
  - _要件: 2.ワインテイスティング記録システム、3.ワイン記録管理・検索システム_

- [ ] 4.2 画像アップロード機能
  - WebP変換とフォールバック処理の実装
  - 画像最適化（圧縮、リサイズ）機能
  - Firebase Storageへのアップロード処理
  - _要件: 2.ワインテイスティング記録システム、13.パフォーマンス最適化_

- [ ] 4.3 検索・フィルタリング機能
  - デバウンス検索（300ms）の実装
  - 複合条件検索（国、地域、品種、価格帯等）
  - 重複ワイン検出機能
  - _要件: 3.ワイン記録管理・検索システム_

## ワイン記録UI実装

- [ ] 5. ワイン選択ページ（SelectWine）
  - 人気ワイン表示コンポーネント
  - リアルタイム検索フォーム
  - 新規ワイン作成フォーム
  - _要件: 2.ワインテイスティング記録システム_

- [ ] 5.1 TagInputコンポーネント
  - Enter/カンマ区切り入力機能
  - タグ削除機能（Backspace + 個別削除ボタン）
  - 重複防止とフォーカス管理
  - _要件: 2.ワインテイスティング記録システム_

- [ ] 5.2 テイスティング記録ページ（AddTastingRecord）
  - クイック・詳細モード切り替えUI
  - 基本情報入力フォーム（ワイン名、生産者、国、地域等）
  - 評価入力（0.0-10.0スケール）とメモ入力
  - _要件: 2.ワインテイスティング記録システム_

- [ ] 5.3 詳細分析フォーム
  - 外観分析入力（色、強度、透明度、粘性）
  - 香り分析入力（第一印象、スワリング後、カテゴリー別評価）
  - 味わい分析入力（アタック、展開、フィニッシュ）
  - 構造分析入力（酸味、タンニン、甘味、ボディ）
  - _要件: 2.ワインテイスティング記録システム_

- [ ] 5.4 環境・コンテキスト記録
  - グラスタイプ選択（8種類、画像付き）
  - 環境情報入力（温度、デカンタ、照明、気分等）
  - 時系列テイスティングノート機能
  - _要件: 18.グラスタイプ選択・環境記録、19.時系列テイスティング・変化記録_

## 手描きキャンバス機能

- [ ] 6. DrawingCanvasコンポーネント
  - HTML5 Canvasを使用した描画機能
  - ペン・消しゴムツールの切り替え
  - ブラシサイズ調整（1-20px）とカラーピッカー
  - _要件: 17.手描きキャンバス・視覚的記録_

- [ ] 6.1 描画機能の実装
  - マウス・タッチイベントの統一処理
  - 描画パスの記録と再生機能
  - PNG形式でのData URL出力
  - _要件: 17.手描きキャンバス・視覚的記録_

## 記録閲覧・管理UI

- [ ] 7. 記録一覧ページ（Records）
  - ワイン別グループ表示
  - 日付ソート機能
  - 公開・非公開切り替え
  - _要件: 3.ワイン記録管理・検索システム_

- [ ] 7.1 WineFilterコンポーネント
  - 4タブUI（種類・産地品種・価格年代・評価）
  - 動的候補表示（ユーザーデータ基準）
  - アクティブフィルター表示とリアルタイムカウント
  - _要件: 3.ワイン記録管理・検索システム_

- [ ] 7.2 個別ワイン詳細ページ（WineDetail）
  - 時系列テイスティング履歴表示
  - 記録の編集・削除機能（所有者のみ）
  - 画像ギャラリー表示
  - _要件: 3.ワイン記録管理・検索システム_

## 統計・分析機能

- [ ] 8. TastingAnalysisChartsコンポーネント
  - Chart.js統合とレーダーチャート（成分バランス）
  - 棒グラフ（香りカテゴリー）の実装
  - 線グラフ（味わいの展開）の実装
  - _要件: 15.統計・分析ダッシュボード_

- [ ] 8.1 統計ページ（Stats）
  - 月別記録数グラフ
  - 国別・品種別分布円グラフ
  - 価格帯別分析と平均評価表示
  - _要件: 15.統計・分析ダッシュボード_

- [ ] 8.2 統計データ計算サービス
  - リアルタイム統計計算機能
  - キャッシュ機能による高速化
  - 年間サマリー生成機能
  - _要件: 15.統計・分析ダッシュボード_

## クイズシステム実装

- [ ] 9. クイズデータ構造
  - 20レベル × 100問 = 2,000問のデータ構造設計
  - QuizQuestion型定義（4択選択式 + 解説）
  - レベル別動的読み込みシステム
  - _要件: 4.ワインクイズ学習システム_

- [ ] 9.1 QuizServiceの実装
  - レベル別問題読み込み機能
  - 問題キャッシュ機能
  - 進捗管理（完了問題、正解数、ベストスコア）
  - _要件: 4.ワインクイズ学習システム_

- [ ] 9.2 クイズメニューページ（Quiz）
  - 20レベルの難易度選択UI
  - 各レベルの進捗表示（完了率、ベストスコア）
  - レベルアンロック機能
  - _要件: 4.ワインクイズ学習システム_

- [ ] 9.3 クイズゲームページ（QuizGame）
  - 4択選択式UI
  - 正解・不正解の即座フィードバック
  - 解説表示機能
  - _要件: 4.ワインクイズ学習システム_

## ハートシステム・進捗管理

- [ ] 10. ハートシステム実装
  - 5ライフ制の実装
  - 30分回復間隔の管理
  - ハート消費・回復の視覚的表示
  - _要件: 4.ワインクイズ学習システム_

- [ ] 10.1 学習進捗管理
  - 間違い復習システム（間隔反復学習）
  - ストリーク追跡（連続正解検出）
  - 全体正解率の計算と表示
  - _要件: 4.ワインクイズ学習システム_

## ゲーミフィケーション実装

- [ ] 11. XPシステム実装
  - 行動別XP付与（記録作成：10-20XP、クイズ正解：5XP）
  - レベル計算（指数進行、1.2倍）
  - XP履歴の記録と表示
  - _要件: 5.ゲーミフィケーション・進捗管理システム_

- [ ] 11.1 バッジシステム実装
  - 67個のバッジ定義（4カテゴリー）
  - バッジ獲得条件の自動チェック
  - バッジ獲得通知とアニメーション
  - _要件: 5.ゲーミフィケーション・進捗管理システム_

- [ ] 11.2 日常目標システム
  - 記録作成・クイズの目標設定
  - 目標達成状況の追跡
  - 達成時のボーナスXP付与
  - _要件: 5.ゲーミフィケーション・進捗管理システム_

- [ ] 11.3 プロフィールページ（Profile）
  - ユーザー統計表示（レベル、XP、バッジ）
  - 獲得バッジ一覧
  - アクティビティ履歴
  - _要件: 5.ゲーミフィケーション・進捗管理システム_

## 過去記録引用システム

- [ ] 12. 引用システム基盤
  - 類似ワイン検索機能（同じ生産者・品種）
  - 引用可能フィールドの表示
  - 引用プレビュー機能
  - _要件: 10.過去記録引用システム_

- [ ] 12.1 引用UI実装
  - 過去記録選択インターフェース
  - フィールド選択チェックボックス
  - 競合フィールドの警告表示
  - _要件: 10.過去記録引用システム_

- [ ] 12.2 引用履歴管理
  - 引用元・引用先の関係記録
  - 被引用回数の追跡
  - 引用後の編集検出
  - _要件: 10.過去記録引用システム_

## PWA・オフライン対応

- [ ] 13. Service Worker設定
  - Vite PWA plugin設定
  - Workboxによるキャッシュ戦略
  - オフライン時のフォールバック処理
  - _要件: 6.PWA・オフライン対応システム_

- [ ] 13.1 PWAマニフェスト
  - アプリマニフェスト（manifest.json）の作成
  - 27種類のアイコン準備（48x48〜512x512）
  - インストールプロンプトの実装
  - _要件: 6.PWA・オフライン対応システム_

- [ ] 13.2 オフライン機能
  - オフライン状態検出
  - ローカルストレージによる一時保存
  - オンライン復帰時の自動同期
  - _要件: 6.PWA・オフライン対応システム_

- [ ] 13.3 自動更新システム
  - 新バージョン検知機能
  - 更新通知UI
  - ユーザー選択による更新実行
  - _要件: 6.PWA・オフライン対応システム_

## プッシュ通知システム

- [ ] 14. Firebase Messaging設定
  - Firebase Cloud Messaging設定
  - VAPID キーの設定
  - Service Worker通知処理
  - _要件: 7.プッシュ通知システム_

- [ ] 14.1 通知管理機能
  - 通知許可リクエスト
  - 通知設定UI（種類別ON/OFF）
  - 静寂時間設定（22:00-08:00）
  - _要件: 7.プッシュ通知システム_

- [ ] 14.2 通知スケジューラー
  - ストリークリマインダー
  - クイズリマインダー
  - ハート回復通知
  - バッジ獲得通知
  - _要件: 7.プッシュ通知システム_

## LLM連携・AI機能

- [ ] 15. LLM API連携
  - OpenRouter/Groq API設定
  - パーソナライズドクイズ生成機能
  - 味覚プロファイル分析機能
  - _要件: 16.LLM連携・AI機能_

- [ ] 15.1 AI機能UI
  - AIクイズ生成ボタン
  - 味覚分析レポート表示
  - 使用回数制限表示（無料：月10回）
  - _要件: 16.LLM連携・AI機能_

## サブスクリプション・決済

- [ ] 16. Stripe統合準備
  - Stripe設定とWebhook準備
  - サブスクリプション状態管理
  - 有料プラン機能制限の実装
  - _要件: 8.サブスクリプション・有料機能システム_

- [ ] 16.1 プラン制限機能
  - 画像アップロード制限（無料：1枚、有料：4枚）
  - 記録数制限（無料：1ワインにつき2記録まで）
  - LLM API制限（無料：月10回）
  - _要件: 8.サブスクリプション・有料機能システム_

## セキュリティ・プライバシー

- [ ] 17. Firestore Security Rules
  - 181行の包括的セキュリティルール実装
  - 認証・認可・データ検証関数
  - 所有者限定アクセス制御
  - _要件: 12.セキュリティ・プライバシー保護_

- [ ] 17.1 Storage Security Rules
  - 階層別アクセス制御
  - ファイルサイズ・形式制限
  - 公開・非公開画像の適切な制御
  - _要件: 12.セキュリティ・プライバシー保護_

- [ ] 17.2 プライバシー機能
  - 公開・非公開設定UI
  - 価格情報の非公開制御
  - データエクスポート機能（GDPR対応）
  - _要件: 12.セキュリティ・プライバシー保護_

## デザイン・テーマシステム

- [ ] 18. ダークテーマ実装
  - CSS Custom Propertiesによるテーマシステム
  - バー雰囲気のカラーパレット（#722F37等）
  - レスポンシブデザイン（320px〜1920px）
  - _要件: 20.レスポンシブデザイン・アクセシビリティ_

- [ ] 18.1 BottomNavigationコンポーネント
  - 5つのナビゲーションアイテム
  - アクティブ状態のハイライト
  - アクセシビリティ対応（aria-current）
  - _要件: 20.レスポンシブデザイン・アクセシビリティ_

- [ ] 18.2 アクセシビリティ対応
  - キーボードナビゲーション
  - スクリーンリーダー対応（ARIA属性）
  - フォーカス管理とスキップリンク
  - _要件: 20.レスポンシブデザイン・アクセシビリティ_

## CI/CD・自動デプロイ

- [ ] 19. GitHub Actions設定
  - Firebase Hosting自動デプロイワークフロー
  - 品質チェックワークフロー（テスト・リント・セキュリティ）
  - プレビューデプロイ（PR時）
  - _要件: CI/CD・自動デプロイ設計_

- [ ] 19.1 自動コミットスクリプト
  - Claude Code連携スクリプト（scripts/auto-commit.ts）
  - ビルドチェック → コミット → プッシュの自動化
  - インテリジェントなコミットメッセージ生成
  - _要件: CI/CD・自動デプロイ設計_

- [ ] 19.2 Git フック設定
  - Pre-commitフック（TypeScript・ESLint・テスト）
  - コミット品質の自動保証
  - VS Code タスク統合
  - _要件: CI/CD・自動デプロイ設計_

## 監視・運用機能

- [ ] 20. エラー追跡・監視
  - Sentry統合とエラー追跡
  - パフォーマンス監視（Core Web Vitals）
  - 構造化ログ管理
  - _要件: 監視・運用設計_

- [ ] 20.1 分析・KPI管理
  - ユーザー行動追跡
  - KPIダッシュボード（DAU、MAU、コンバージョン率）
  - A/Bテストフレームワーク
  - _要件: データ分析・ビジネスインテリジェンス設計_

## テスト実装

- [ ] 21. 単体テスト
  - Jest + Testing Library設定
  - コンポーネントテスト（ErrorMessage、LoadingSpinner、WineCard）
  - フックテスト（useErrorHandler）
  - サービステスト（TastingRecordService）
  - _要件: 品質保証・テスト戦略_

- [ ] 21.1 E2Eテスト
  - Playwright設定
  - ワイン記録作成フローのテスト
  - クイズ完了フローのテスト
  - _要件: 品質保証・テスト戦略_

- [ ] 21.2 パフォーマンステスト
  - k6による負荷テスト
  - バンドルサイズ分析
  - Core Web Vitals測定
  - _要件: 品質保証・テスト戦略_

## 最終統合・デプロイ

- [ ] 22. 本番環境準備
  - 環境変数の設定
  - Firebase プロジェクトの本番設定
  - ドメイン設定（my-wine-memory.himazi.com）
  - _要件: 全体的な運用準備_

- [ ] 22.1 データ移行・初期化
  - 初期ユーザーデータの準備
  - クイズデータの投入
  - バッジ・レベル設定の確認
  - _要件: 全体的なデータ準備_

- [ ] 22.2 最終テスト・リリース
  - 全機能の統合テスト
  - パフォーマンス最終チェック
  - セキュリティ監査
  - 本番リリース
  - _要件: 全体的な品質保証_